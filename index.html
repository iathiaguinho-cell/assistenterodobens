<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>thIAguinho Pace Pro NAV v2.2</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; overflow: hidden; background-color: #0c0a09; }
        body { font-family: 'Roboto Mono', monospace; touch-action: manipulation; }
        .display-font { font-family: 'Orbitron', sans-serif; }
        #app-container { position: relative; z-index: 1000; pointer-events: none; }
        #app-container > * { pointer-events: auto; }
        #map { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        .leaflet-control-attribution, .leaflet-control-zoom { display: none; }
        
        .bg-pace-ok { background-color: #10B981; } .text-pace-ok { color: #10B981; }
        .bg-pace-fast { background-color: #EF4444; } .text-pace-fast { color: #EF4444; }
        .bg-pace-slow { background-color: #3B82F6; } .text-pace-slow { color: #3B82F6; }
        .bg-pace-standby { background-color: #4B5563; } .text-pace-standby { color: #6B7280; }
        
        @keyframes slideInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .tactic-card-animation { animation: slideInUp 0.6s ease-out forwards; }
        button { -webkit-tap-highlight-color: transparent; }
        .runner-icon div {
            width: 16px; height: 16px; background-color: #60A5FA; border-radius: 50%;
            border: 2px solid #FFFFFF; box-shadow: 0 0 10px #60A5FA;
        }

        /* --- ESTILOS PARA PAINEL RETRÁTIL --- */
        #metrics-panel { transition: transform 0.3s ease-in-out, max-height 0.3s ease-in-out; }
        #metrics-panel.minimized {
            transform: translateY(calc(100% - 90px)); /* Mostra apenas o topo */
        }
        #metrics-panel.minimized #tactic-card, 
        #metrics-panel.minimized #elapsed-time-container, 
        #metrics-panel.minimized #controls,
        #metrics-panel.minimized #status {
            display: none;
        }
        #minimize-toggle {
            position: absolute;
            top: 0; left: 50%;
            transform: translate(-50%, -100%);
            width: 80px;
            height: 20px;
            background-color: rgba(31, 25, 23, 0.8);
            backdrop-filter: blur(4px);
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            border: 1px solid #3f3f46;
            border-bottom: none;
            cursor: pointer;
            display: none; /* Inicia oculto */
            justify-content: center;
            align-items: center;
        }
        #minimize-toggle svg { transition: transform 0.3s ease-in-out; }
        #metrics-panel.minimized #minimize-toggle svg { transform: rotate(180deg); }

    </style>
</head>
<body class="antialiased text-stone-200">

    <div id="map"></div>

    <div id="app-container" class="flex flex-col h-full p-4 max-w-md mx-auto w-full justify-end">
        <div id="metrics-panel" class="bg-stone-900/80 backdrop-blur-sm p-4 rounded-2xl border border-stone-700 w-full tactic-card-animation relative">
            <div id="minimize-toggle">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9L12 15L18 9" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            
            <div class="grid grid-cols-3 gap-2 w-full text-center mb-3">
                <div class="col-span-1">
                    <p class="text-sm md:text-md text-gray-400">RITMO</p>
                    <p id="current-pace" class="text-3xl md:text-4xl display-font text-pace-standby">--:--</p>
                </div>
                <div class="col-span-1">
                    <p class="text-sm md:text-md text-gray-400">STATUS</p>
                    <p id="pace-status-text" class="text-3xl md:text-4xl display-font text-pace-standby">---</p>
                </div>
                <div class="col-span-1">
                     <p class="text-sm md:text-md text-gray-400">DISTÂNCIA</p>
                    <p id="distance" class="text-3xl md:text-4xl display-font">0.00</p>
                </div>
            </div>

            <div id="tactic-card" class="w-full bg-stone-800/50 p-3 rounded-lg border border-stone-700">
                 <div class="text-center">
                    <p class="text-xs text-gray-500">ESTRATÉGIA KM <span id="current-km-label" class="display-font">1</span></p>
                    <p id="tactic-instruction" class="text-sm md:text-base text-amber-400 mt-1 font-bold h-10 flex items-center justify-center"></p>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-4 w-full text-center mt-3" id="elapsed-time-container">
                <div>
                    <p class="text-sm md:text-md text-gray-400">TEMPO DECORRIDO</p>
                    <p id="elapsed-time" class="text-3xl md:text-4xl display-font">00:00:00</p>
                </div>
            </div>

            <p id="status" class="text-amber-400 h-6 mt-3 text-center text-sm">Aguardando início...</p>
            
            <div id="controls" class="flex justify-center gap-4 mt-2">
                <button id="start-btn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg transition-transform transform active:scale-95">
                    INICIAR
                </button>
                <button id="pause-btn" class="w-1/2 bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-6 rounded-lg text-xl shadow-lg hidden transition-transform transform active:scale-95">
                    PAUSAR
                </button>
                <button id="stop-btn" class="w-1/2 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg text-xl shadow-lg hidden transition-transform transform active:scale-95">
                    PARAR
                </button>
            </div>
        </div>
    </div>

    <script>
    // ===================================================================================
    // ARQUITETURA DO SISTEMA DE CORRIDA - v2.2 (BLINDADO)
    // ===================================================================================
    const gpxData = `<?xml version="1.0" encoding="UTF-8"?>
<gpx creator="strava.com" version="1.1" xmlns="http://www.topografix.com/GPX/1/1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
 <metadata>
  <name>Rodobens </name>
  <author>
   <name>Tiago C.</name>
   <link href="https://www.strava.com/athletes/13813939"/>
  </author>
 </metadata>
 <trk>
  <name>Rodobens </name>
  <type>1</type>
  <trkseg>
   <trkpt lat="-20.8258600" lon="-49.3900300">
    <ele>449.6</ele>
   </trkpt>
   <trkpt lat="-20.8251200" lon="-49.3895900">
    <ele>448.2</ele>
   </trkpt>
   <trkpt lat="-20.8241900" lon="-49.3891400">
    <ele>446.5</ele>
   </trkpt>
   <trkpt lat="-20.8225000" lon="-49.3882700">
    <ele>443.2</ele>
   </trkpt>
   <trkpt lat="-20.8209800" lon="-49.3875300">
    <ele>440.4</ele>
   </trkpt>
   <trkpt lat="-20.8193800" lon="-49.3867600">
    <ele>437.5</ele>
   </trkpt>
   <trkpt lat="-20.8178800" lon="-49.3860800">
    <ele>435.3</ele>
   </trkpt>
   <trkpt lat="-20.8164300" lon="-49.3854000">
    <ele>433.0</ele>
   </trkpt>
   <trkpt lat="-20.8149800" lon="-49.3847300">
    <ele>430.7</ele>
   </trkpt>
   <trkpt lat="-20.8134200" lon="-49.3840200">
    <ele>428.3</ele>
   </trkpt>
   <trkpt lat="-20.8118000" lon="-49.3832800">
    <ele>426.2</ele>
   </trkpt>
   <trkpt lat="-20.8105700" lon="-49.3826900">
    <ele>424.8</ele>
   </trkpt>
   <trkpt lat="-20.8093100" lon="-49.3819800">
    <ele>423.5</ele>
   </trkpt>
   <trkpt lat="-20.8082000" lon="-49.3812700">
    <ele>422.5</ele>
   </trkpt>
   <trkpt lat="-20.8073500" lon="-49.3807300">
    <ele>421.9</ele>
   </trkpt>
   <trkpt lat="-20.8066500" lon="-49.3801100">
    <ele>421.5</ele>
   </trkpt>
   <trkpt lat="-20.8059000" lon="-49.3792300">
    <ele>421.5</ele>
   </trkpt>
   <trkpt lat="-20.8055600" lon="-49.3784100">
    <ele>421.9</ele>
   </trkpt>
   <trkpt lat="-20.8052000" lon="-49.3774800">
    <ele>422.6</ele>
   </trkpt>
   <trkpt lat="-20.8051400" lon="-49.3763700">
    <ele>423.7</ele>
   </trkpt>
   <trkpt lat="-20.8054400" lon="-49.3754900">
    <ele>424.9</ele>
   </trkpt>
   <trkpt lat="-20.8060800" lon="-49.3746300">
    <ele>426.6</ele>
   </trkpt>
   <trkpt lat="-20.8074000" lon="-49.3736700">
    <ele>429.2</ele>
   </trkpt>
   <trkpt lat="-20.8085400" lon="-49.3730200">
    <ele>431.1</ele>
   </trkpt>
   <trkpt lat="-20.8097600" lon="-49.3724300">
    <ele>432.9</ele>
   </trkpt>
   <trkpt lat="-20.8109300" lon="-49.3719400">
    <ele>434.6</ele>
   </trkpt>
   <trkpt lat="-20.8122000" lon="-49.3714500">
    <ele>436.4</ele>
   </trkpt>
   <trkpt lat="-20.8134000" lon="-49.3711100">
    <ele>437.9</ele>
   </trkpt>
   <trkpt lat="-20.8145700" lon="-49.3711800">
    <ele>438.8</ele>
   </trkpt>
   <trkpt lat="-20.8153400" lon="-49.3716000">
    <ele>439.3</ele>
   </trkpt>
   <trkpt lat="-20.8159100" lon="-49.3722500">
    <ele>439.7</ele>
   </trkpt>
   <trkpt lat="-20.8163500" lon="-49.3730700">
    <ele>440.0</ele>
   </trkpt>
   <trkpt lat="-20.8167000" lon="-49.3739700">
    <ele>440.2</ele>
   </trkpt>
   <trkpt lat="-20.8170500" lon="-49.3749200">
    <ele>440.4</ele>
   </trkpt>
   <trkpt lat="-20.8174400" lon="-49.3758300">
    <ele>440.7</ele>
   </trkpt>
   <trkpt lat="-20.8180400" lon="-49.3767000">
    <ele>441.2</ele>
   </trkpt>
   <trkpt lat="-20.8190200" lon="-49.3776100">
    <ele>442.2</ele>
   </trkpt>
   <trkpt lat="-20.8203500" lon="-49.3783400">
    <ele>443.6</ele>
   </trkpt>
   <trkpt lat="-20.8217300" lon="-49.3788700">
    <ele>445.3</ele>
   </trkpt>
   <trkpt lat="-20.8231200" lon="-49.3793700">
    <ele>447.1</ele>
   </trkpt>
   <trkpt lat="-20.8242400" lon="-49.3799300">
    <ele>448.5</ele>
   </trkpt>
   <trkpt lat="-20.8250200" lon="-49.3804300">
    <ele>449.4</ele>
   </trkpt>
   <trkpt lat="-20.8255500" lon="-49.3811100">
    <ele>450.2</ele>
   </trkpt>
   <trkpt lat="-20.8258300" lon="-49.3818300">
    <ele>450.7</ele>
   </trkpt>
   <trkpt lat="-20.8259600" lon="-49.3826300">
    <ele>451.2</ele>
   </trkpt>
   <trkpt lat="-20.8260000" lon="-49.3834600">
    <ele>451.7</ele>
   </trkpt>
   <trkpt lat="-20.8259100" lon="-49.3843500">
    <ele>452.1</ele>
   </trkpt>
   <trkpt lat="-20.8256300" lon="-49.3852800">
    <ele>452.3</ele>
   </trkpt>
   <trkpt lat="-20.8251200" lon="-49.3862200">
    <ele>452.3</ele>
   </trkpt>
   <trkpt lat="-20.8243500" lon="-49.3871100">
    <ele>452.1</ele>
   </trkpt>
   <trkpt lat="-20.8233300" lon="-49.3879400">
    <ele>451.7</ele>
   </trkpt>
   <trkpt lat="-20.8221600" lon="-49.3887100">
    <ele>451.1</ele>
   </trkpt>
   <trkpt lat="-20.8209800" lon="-49.3894300">
    <ele>450.3</ele>
   </trkpt>
   <trkpt lat="-20.8199700" lon="-49.3899400">
    <ele>449.6</ele>
   </trkpt>
   <trkpt lat="-20.8192300" lon="-49.3902300">
    <ele>449.4</ele>
   </trkpt>
   <trkpt lat="-20.8189600" lon="-49.3902800">
    <ele>449.3</ele>
   </trkpt>
  </trkseg>
 </trk>
</gpx>`;

    const racePlan = [
        { km: 1, tactic: "CONTROLE! Use a descida, não force. Corrida solta.", minPace: 315, maxPace: 325 }, { km: 2, tactic: "Mantenha o controle. Encontre seu ritmo de cruzeiro.", minPace: 320, maxPace: 330 }, { km: 3, tactic: "Terreno plano. Ritmo firme e confortável. Cheque o corpo.", minPace: 325, maxPace: 335 }, { km: 4, tactic: "PRIMEIRA SUBIDA. Absorva. Encurte a passada, use os braços.", minPace: 340, maxPace: 350 }, { km: 5, tactic: "Recupere o ritmo de cruzeiro. Respire fundo.", minPace: 330, maxPace: 340 }, { km: 6, tactic: "DESCIDA. Solte as pernas! Ganhe tempo aqui. Deixe fluir.", minPace: 310, maxPace: 320 }, { km: 7, tactic: "Aproveite a descida. Mantenha a velocidade sem esforço extra.", minPace: 310, maxPace: 320 }, { km: 8, tactic: "Prepare a mente. A subida final começa. Controle o esforço.", minPace: 335, maxPace: 345 }, { km: 9, tactic: "SUBIDA DECISIVA! Foco na força. Postura erguida. VOCÊ TREINOU PRA ISSO!", minPace: 350, maxPace: 365 }, { km: 10, tactic: "O PIOR JÁ PASSOU! Use a energia que guardou. DÊ TUDO ATÉ O FIM!", minPace: 0, maxPace: 345 }
    ];

    const ui = {
        currentPace: document.getElementById('current-pace'), paceStatusText: document.getElementById('pace-status-text'), tacticInstruction: document.getElementById('tactic-instruction'), currentKmLabel: document.getElementById('current-km-label'), elapsedTime: document.getElementById('elapsed-time'), distance: document.getElementById('distance'), status: document.getElementById('status'), startBtn: document.getElementById('start-btn'), pauseBtn: document.getElementById('pause-btn'), stopBtn: document.getElementById('stop-btn'), metricsPanel: document.getElementById('metrics-panel'), minimizeToggle: document.getElementById('minimize-toggle')
    };
    
    let map, routePolyline, runnerMarker;
    let state = 'stopped';
    let watchId = null, startTime = 0, pausedTime = 0, totalPausedTime = 0;
    let totalDistance = 0, currentKmInteger = 0;
    let positions = [];
    let mainInterval = null;
    let routeCoordinates = [];

    function parseGPX(gpxStr) {
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(gpxStr, "text/xml");
        const trackpoints = xmlDoc.getElementsByTagName('trkpt');
        if (trackpoints.length === 0) return [];
        const coords = [];
        for (let i = 0; i < trackpoints.length; i++) {
            coords.push([parseFloat(trackpoints[i].getAttribute('lat')), parseFloat(trackpoints[i].getAttribute('lon'))]);
        }
        return coords;
    }

    function initializeMap() {
        map = L.map('map', { zoomControl: false }).setView(routeCoordinates[0] || [-20.825, -49.390], 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
        if (routeCoordinates.length > 0) {
            routePolyline = L.polyline(routeCoordinates, { color: '#FBBF24', weight: 5, opacity: 0.8 }).addTo(map);
            map.fitBounds(routePolyline.getBounds().pad(0.1));
        }
        const runnerIcon = L.divIcon({ className: 'runner-icon', html: '<div></div>', iconSize: [16, 16], iconAnchor: [8, 8] });
        runnerMarker = L.marker(routeCoordinates[0] || [-20.825, -49.390], { icon: runnerIcon }).addTo(map);
    }
    
    function haversineDistance(coords1, coords2) {
        const R = 6371; const dLat = (coords2.latitude - coords1.latitude) * Math.PI / 180; const dLon = (coords2.longitude - coords1.longitude) * Math.PI / 180; const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(coords1.latitude * Math.PI / 180) * Math.cos(coords2.latitude * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2); const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); return R * c;
    }

    function formatTime(totalSeconds) {
        const h = Math.floor(totalSeconds / 3600).toString().padStart(2, '0'); const m = Math.floor((totalSeconds % 3600) / 60).toString().padStart(2, '0'); const s = (totalSeconds % 60).toString().padStart(2, '0'); return `${h}:${m}:${s}`;
    }

    function formatPace(secondsPerKm) {
        if (isNaN(secondsPerKm) || !isFinite(secondsPerKm) || secondsPerKm <= 0) return '--:--';
        const m = Math.floor(secondsPerKm / 60); const s = Math.round(secondsPerKm % 60).toString().padStart(2, '0'); return `${m}:${s}`;
    }
    
    function handleGpsError(error) {
        console.error("GPS Error:", error);
        let message = "Falha no sinal de GPS.";
        if (error.code === 1) message = "Acesso ao GPS negado. Verifique as permissões.";
        if (error.code === 2) message = "Sinal de GPS indisponível.";
        ui.status.textContent = message;
        stopRun(false); // Para a corrida mas sem resetar tudo
    }

    function handlePosition(position) {
        ui.status.textContent = 'GPS OK. Correndo...';
        const { latitude, longitude } = position.coords;
        runnerMarker.setLatLng([latitude, longitude]);
        map.setView([latitude, longitude], 17, { animate: true, pan: { duration: 1 } });
        const newPosition = { coords: { latitude, longitude }, timestamp: position.timestamp };
        if (positions.length > 0) totalDistance += haversineDistance(positions[positions.length - 1].coords, newPosition.coords);
        positions.push(newPosition);
    }

    function updateDisplay() {
        if (state !== 'running') return;
        const elapsedTimeInSeconds = Math.floor((Date.now() - startTime - totalPausedTime) / 1000);
        ui.elapsedTime.textContent = formatTime(elapsedTimeInSeconds);
        ui.distance.textContent = totalDistance.toFixed(2);
        
        let currentPaceInSeconds = 0;
        if (positions.length > 1) {
            const lastPos = positions[positions.length - 1];
            const prevPos = positions[positions.length - 2];
            const dist = haversineDistance(prevPos.coords, lastPos.coords) * 1000;
            const time = (lastPos.timestamp - prevPos.timestamp) / 1000;
            if (time > 0) {
                const speed = dist / time;
                currentPaceInSeconds = speed > 0 ? 1000 / speed : 0;
            }
        }
        ui.currentPace.textContent = formatPace(currentPaceInSeconds);
        
        currentKmInteger = Math.floor(totalDistance) + 1;
        const currentPlan = racePlan.find(p => p.km === currentKmInteger);
        if (currentPlan) {
            ui.currentKmLabel.textContent = currentKmInteger;
            ui.tacticInstruction.textContent = currentPlan.tactic;
            const paceClass = currentPaceInSeconds === 0 ? 'standby' : currentPaceInSeconds < currentPlan.minPace ? 'fast' : currentPaceInSeconds > currentPlan.maxPace ? 'slow' : 'ok';
            const statusText = currentPaceInSeconds === 0 ? '---' : paceClass === 'fast' ? 'RÁPIDO' : paceClass === 'slow' ? 'LENTO' : 'IDEAL';
            ui.paceStatusText.textContent = statusText;
            ui.currentPace.className = `text-3xl md:text-4xl display-font text-pace-${paceClass}`;
            ui.paceStatusText.className = `text-3xl md:text-4xl display-font text-pace-${paceClass}`;
        } else {
            ui.tacticInstruction.textContent = "PROVA CONCLUÍDA! PARABÉNS!";
        }
    }

    function startRun() {
        if (state === 'stopped') {
            startTime = Date.now(); totalPausedTime = 0; totalDistance = 0; positions = []; resetUI(true);
            const firstPlan = racePlan[0];
            ui.currentKmLabel.textContent = firstPlan.km; ui.tacticInstruction.textContent = firstPlan.tactic;
        } else if (state === 'paused') {
            totalPausedTime += Date.now() - pausedTime;
        }
        state = 'running';
        ui.status.textContent = 'Buscando sinal de GPS...';
        ui.startBtn.classList.add('hidden'); ui.pauseBtn.classList.remove('hidden'); ui.stopBtn.classList.remove('hidden');
        ui.minimizeToggle.style.display = 'flex'; ui.metricsPanel.classList.add('minimized');

        watchId = navigator.geolocation.watchPosition(handlePosition, handleGpsError, { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 });
        mainInterval = setInterval(updateDisplay, 1000);
    }

    function pauseRun() {
        if (state !== 'running') return;
        state = 'paused'; pausedTime = Date.now();
        clearInterval(mainInterval); navigator.geolocation.clearWatch(watchId);
        ui.status.textContent = 'Pausado.';
        ui.pauseBtn.classList.add('hidden'); ui.startBtn.classList.remove('hidden');
        ui.startBtn.textContent = 'RETOMAR';
    }
    
    function stopRun(fullReset = true) {
        state = 'stopped';
        clearInterval(mainInterval); if (watchId) navigator.geolocation.clearWatch(watchId); watchId = null;
        if (fullReset) {
            ui.status.textContent = 'Corrida finalizada. Pronto para a próxima.';
            ui.startBtn.textContent = 'INICIAR';
        }
        ui.startBtn.classList.remove('hidden'); ui.pauseBtn.classList.add('hidden'); ui.stopBtn.classList.add('hidden');
        ui.minimizeToggle.style.display = 'none'; ui.metricsPanel.classList.remove('minimized');
    }

    function resetUI(isStarting = false) {
        if (!isStarting) {
            ui.elapsedTime.textContent = '00:00:00'; ui.distance.textContent = '0.00';
            ui.status.textContent = 'Aguardando início...';
        }
        ui.currentPace.textContent = '--:--'; ui.paceStatusText.textContent = '---';
        const standbyClass = "text-3xl md:text-4xl display-font text-pace-standby";
        ui.currentPace.className = standbyClass; ui.paceStatusText.className = standbyClass;
        ui.currentKmLabel.textContent = '1'; ui.tacticInstruction.textContent = '';
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        ui.startBtn.addEventListener('click', startRun);
        ui.pauseBtn.addEventListener('click', pauseRun);
        ui.stopBtn.addEventListener('click', stopRun);
        ui.minimizeToggle.addEventListener('click', () => ui.metricsPanel.classList.toggle('minimized'));

        if (gpxData && gpxData.trim() !== '') {
            routeCoordinates = parseGPX(gpxData);
            if (routeCoordinates.length > 0) ui.status.textContent = "Rota carregada. Pronto.";
            else ui.status.textContent = "GPX inválido.";
        } else {
            ui.status.textContent = "Nenhum GPX na configuração.";
        }
        initializeMap(); resetUI();
    });
    </script>
</body>
</html>
